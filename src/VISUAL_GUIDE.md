# ğŸ“¸ VISUAL GUIDE - Step by Step

## Error You Got
```
âŒ Failed to run sql query: ERROR: 42704: 
   unrecognized exception condition "duplicate_key"
```

**Cause:** Wrong PostgreSQL exception name

**Fix:** Use `/supabase/migrations/COMPLETE_FIX_V3_CORRECTED.sql` instead

---

## Step-by-Step Visual Guide

### STEP 1: Open Supabase Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  https://app.supabase.com              â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Select Your Project               â”‚ â”‚
â”‚  â”‚ â–¼ ShopEasy (or your project name)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 2: Go to SQL Editor
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Left Sidebar:                           â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š Database                             â”‚
â”‚ ğŸ” Authentication                       â”‚
â”‚ ğŸ“ SQL Editor  â† CLICK THIS            â”‚
â”‚ ğŸ”§ Edge Functions                       â”‚
â”‚ ğŸ“ˆ Storage                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 3: Open the Corrected SQL File
```
In your code editor:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /supabase/                              â”‚
â”‚   /migrations/                          â”‚
â”‚     COMPLETE_FIX_V3_CORRECTED.sql  â† THISâ”‚
â”‚     COMPLETE_FIX_V2.sql            â† NOT THIS
â”‚     FIX_INVENTORY_CONSTRAINT.sql   â† NOT THIS
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 4: Copy Entire File
```
1. Click in the file
2. Press: Ctrl + A  (Select All)
3. Press: Ctrl + C  (Copy)
```

### STEP 5: Paste in Supabase SQL Editor
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQL Editor                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ -- COMPLETE FIX V3                  â”‚ â”‚
â”‚ â”‚ -- ==================               â”‚ â”‚
â”‚ â”‚ DO $$                               â”‚ â”‚
â”‚ â”‚ DECLARE                             â”‚ â”‚
â”‚ â”‚   ...                               â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ [Paste your copied SQL here]        â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ [Run] button                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 6: Click Run
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  [â–¶ Run]  â† CLICK THIS BUTTON          â”‚
â”‚                                         â”‚
â”‚  Or press: Ctrl + Enter                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 7: Watch the Output
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Results:                                â”‚
â”‚                                         â”‚
â”‚ âœ… Cleaned up old constraints           â”‚
â”‚ âœ… Added unique constraint              â”‚
â”‚ âœ… Created branch inventory index       â”‚
â”‚ âœ… Created warehouse inventory index    â”‚
â”‚ âœ… Dropped old RLS policies             â”‚
â”‚ âœ… Granted permissions                  â”‚
â”‚ âœ… Created upsert_inventory_safe        â”‚
â”‚ ========================================â”‚
â”‚ VERIFICATION RESULTS:                   â”‚
â”‚ ========================================â”‚
â”‚ Unique Constraint: 1 (expected: 1)     â”‚
â”‚ Indexes: 2 (expected: 2)               â”‚
â”‚ RLS Policies: 4 (expected: 4)          â”‚
â”‚ Upsert Function: 1 (expected: 1)       â”‚
â”‚ ========================================â”‚
â”‚ âœ…âœ…âœ… ALL CHECKS PASSED! âœ…âœ…âœ…         â”‚
â”‚ ğŸ‰ MIGRATION COMPLETE! ğŸ‰              â”‚
â”‚ ========================================â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… If you see this, it worked!**

### STEP 8: Hard Refresh Browser
```
Open your app:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Press: Ctrl + Shift + R               â”‚
â”‚  (Windows/Linux)                        â”‚
â”‚                                         â”‚
â”‚  Or: Cmd + Shift + R                   â”‚
â”‚  (Mac)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### STEP 9: Test POS Sale
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POS Terminal                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Add product to cart                 â”‚ â”‚
â”‚ â”‚ Click "Complete Sale"               â”‚ â”‚
â”‚ â”‚ Select payment method: Cash         â”‚ â”‚
â”‚ â”‚ Click "Confirm"                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ EXPECTED:                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ§¾ Receipt                          â”‚ â”‚
â”‚ â”‚ Receipt #123456                     â”‚ â”‚
â”‚ â”‚ Date: ...                           â”‚ â”‚
â”‚ â”‚ Items: ...                          â”‚ â”‚
â”‚ â”‚ Total: â‚¦...                         â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ [Print] [New Sale]                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… If receipt appears, POS is working!**

### STEP 10: Test Transfer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transfers Page                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Create Transfer                     â”‚ â”‚
â”‚ â”‚ From: Branch A                      â”‚ â”‚
â”‚ â”‚ To: Branch B                        â”‚ â”‚
â”‚ â”‚ Product: Test Product               â”‚ â”‚
â”‚ â”‚ Quantity: 5                         â”‚ â”‚
â”‚ â”‚ [Create Transfer]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ Transfer appears in list:               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Status: Pending                     â”‚ â”‚
â”‚ â”‚ [Approve] [Reject]                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ Click [Approve]:                        â”‚
â”‚ âœ… Branch A stock decreases by 5       â”‚
â”‚                                         â”‚
â”‚ Click [Complete]:                       â”‚
â”‚ âœ… Branch B stock increases by 5       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… If stock updates, transfers are working!**

---

## Browser Console Check (F12)

### Good Logs âœ…
```
Console:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Sale completed successfully          â”‚
â”‚ ğŸ“„ Receipt data prepared               â”‚
â”‚ ğŸ“¤ [APPROVED] Deducting from source    â”‚
â”‚ ğŸ“¥ [COMPLETED] Adding to destination   â”‚
â”‚ âœ… Branch stock adjusted successfully   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Bad Logs âŒ
```
Console:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ function upsert_inventory_safe       â”‚
â”‚    does not exist                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**If you see this error:**
1. Migration didn't run successfully
2. Go back to STEP 2 and run the SQL again
3. Make sure you see "ALL CHECKS PASSED"

---

## Summary Checklist

```
â–¡ Opened Supabase Dashboard
â–¡ Clicked SQL Editor
â–¡ Copied COMPLETE_FIX_V3_CORRECTED.sql
â–¡ Pasted in SQL Editor
â–¡ Clicked Run
â–¡ Saw "ALL CHECKS PASSED" âœ…
â–¡ Hard refreshed browser (Ctrl+Shift+R)
â–¡ Tested POS sale â†’ Receipt appeared âœ…
â–¡ Tested transfer â†’ Stock updated âœ…
â–¡ No errors in console âœ…
```

**All checked? You're done! ğŸ‰**

---

## File Reference

```
ğŸ“ Your Project
â”œâ”€â”€ /supabase/
â”‚   â””â”€â”€ /migrations/
â”‚       â””â”€â”€ COMPLETE_FIX_V3_CORRECTED.sql  â† USE THIS
â”‚
â”œâ”€â”€ START_HERE.md          â† Read first
â”œâ”€â”€ QUICK_START.md         â† Quick guide
â”œâ”€â”€ VISUAL_GUIDE.md        â† You are here
â”œâ”€â”€ RUN_THIS_NOW.md        â† Detailed guide
â””â”€â”€ FIXED_SQL_ERROR.md     â† What was fixed
```

---

**Follow the visual steps above and it will work!** ğŸš€
